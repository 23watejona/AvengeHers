<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
</head>

<body>
    <form action="javascript:void(0);" id="createUserForm">
        <label for="email">Email: </label>
        <input type="email" name="email" id="email" pattern="^\w+?@purdue\.edu$" oninvalid="this.setCustomValidity('Must be a Purdue Email')" oninput="this.setCustomValidity('')"><br />
        <label for="password" >Password: </label>
        <input type="password" name="password" id="password"><br />
        <label for="password-confirm">Confirm Password: </label>
        <input type="password" name="password-confirm" id="password-confirm"><br />
        <input type="submit">
    </form>
</body>
<script type="text/javascript">
function hash(string) {
    const utf8 = new TextEncoder().encode(string);
    return crypto.subtle.digest('SHA-256', utf8).then((hashBuffer) => {
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray
            .map((bytes) => bytes.toString(16).padStart(2, '0'))
            .join('');
        return hashHex;
    });
}
</script>
<script>
let form = document.getElementById("createUserForm");
form.onchange = dataVerify;
form.onsubmit = dataSubmit;

let emailInput = document.getElementById('email');
let passwordInput = document.getElementById('password');
let passwordConfirmInput = document.getElementById('password-confirm');

function dataVerify() {
    let email = emailInput.value;
    let password = passwordInput.value;
    let passwordConfirm = passwordConfirmInput.value;
    if (password != passwordConfirm) {
        passwordInput.setCustomValidity("Passwords Don't Match");
        passwordInput.reportValidity();
    } else {
        passwordInput.setCustomValidity('');
        passwordInput.reportValidity();
    }
    if (!emailInput.checkValidity()) {
        emailInput.setCustomValidity("Must be a Purdue Email Address");
    } else {
        emailInput.setCustomValidity('');
    }

}

function dataSubmit() {
    let formData = new FormData(form);
    formData.delete("password-confirm");
    let request = new XMLHttpRequest();
    request.open('POST', 'create.html', false);
    request.onload = () => {
        if (request.readyState === request.DONE) {
            if (request.status === 200) {
                console.log(request.response);
            }
        }
    }
    request.send(new URLSearchParams(new FormData(form)).toString())

}
</script>

</html>