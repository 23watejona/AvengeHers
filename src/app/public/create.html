<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
</head>

<body>
    <form action="javascript:void(0);" id="createUserForm">
        <label for="name">Name: </label>
        <input type="name" name="name" id="name"><br />
        <label for="email">Email: </label>
        <input type="email" name="email" id="email" pattern="^\w+?@purdue\.edu$" oninvalid="this.setCustomValidity('Must be a Purdue Email')" oninput="this.setCustomValidity('')"><br />
        <label for="password" >Password: </label>
        <input type="password" name="password" id="password"><br />
        <label for="password-confirm">Confirm Password: </label>
        <input type="password" name="password-confirm" id="password-confirm"><br />
        <input type="submit">
    </form>
</body>
<script>
let form = document.getElementById("createUserForm");
let emailInput = document.getElementById('email');
let passwordInput = document.getElementById('password');
let passwordConfirmInput = document.getElementById('password-confirm');

form.onchange = () => {
    passwordConfirmInput.setCustomValidity("");
        emailInput.setCustomValidity("");
};
form.onsubmit = dataSubmit;


function dataVerify() {
    let email = emailInput.value;
    let password = passwordInput.value;
    let passwordConfirm = passwordConfirmInput.value;
    if (password != passwordConfirm) {
        passwordConfirmInput.setCustomValidity("Passwords Don't Match");
        passwordConfirmInput.reportValidity();
        return false;
    } else {
        passwordConfirmInput.setCustomValidity('');
        passwordConfirmInput.reportValidity();
    }
    if (!emailInput.checkValidity()) {
        emailInput.setCustomValidity("Must be a Purdue Email Address");
        return false;
    } else {
        emailInput.setCustomValidity('');
    }
    return true;
}

function dataSubmit() {
    if(!dataVerify()) {
        return;
    }
    let formData = new FormData(form);
    formData.delete("password-confirm");
    let request = new XMLHttpRequest();
    request.open('POST', 'create.html', false);
    request.onload = () => {
        if (request.readyState === request.DONE) {
            if (request.status === 200) {
                console.log(request.response);
            }
        }
    }
    console.log((new FormData(form)).toString);
    request.send(new URLSearchParams(new FormData(form)).toString());

}
</script>

</html>